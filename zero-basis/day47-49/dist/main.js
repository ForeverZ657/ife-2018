!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){e.exports=n.p+"5e3120f346f16d449192cc4a369a7810.png"},function(e,t,n){e.exports=n.p+"e880c6a8c20c8bab6781b0cc0fe5b7da.png"},function(e,t,n){e.exports=n.p+"8f07ad3c38516e341a0b85068c703703.png"},function(e,t,n){"use strict";n.r(t);n(5);function r(e){document.querySelector(".cash").innerHTML=`Cash: ${e.getCash()}`}function i(e){document.querySelector(".waiting-num").innerHTML=`Waiting: ${e}`}var s={wait:function(e){return new Promise(t=>setTimeout(t,e))},move:function(e,t,n){let r=document.getElementById(e.id);"hor"===t?r.style.left=n+"px":r.style.top=n+"px"},renderKitchenDishList:function(e){let t=document.querySelector(".kitchen .dish-list");for(;t.firstChild;)t.removeChild(t.firstChild);e.forEach(e=>{let n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)})},renderDiningDishList:function(e){let t=document.querySelector(".dining-area .dish-list");for(;t.firstChild;)t.removeChild(t.firstChild);e.length&&e.forEach(e=>{let n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)})},startCountdown:function(e,t,n){let r=document.querySelector(t);!function t(){r.innerHTML=`${n} (${e--}s)`,e>0&&setTimeout(t,1e3)}()},initView:function(e){for(let t of e.staff)switch(t.constructor.name){case"Cook":let e=new Image;e.src=t.img,document.querySelector(".kitchen").appendChild(e);break;case"Waiter":let n=new Image;n.src=t.img,n.setAttribute("id",t.id),document.querySelector(".dining-area").appendChild(n)}for(let t of e.customerQueue){let e=new Image;e.src=t.img,e.setAttribute("id",t.id),document.querySelector(".waiting-area").appendChild(e)}r(e),i(e.customerQueue.length)},updateCash:r,updateLog:function(e){let t=document.createElement("p");t.innerHTML=e;let n=document.querySelector(".log");n.appendChild(t),n.scrollTop=n.scrollHeight},updateWaitingNum:i};class a{constructor(e){this.cash=e.cash,this.seats=e.seats,this.staff=e.staff,this.customerQueue=e.customerQueue}hire(e){this.staff.push(e),this.cash-=e.salary}fire(e){this.staff.splice(this.staff.indexOf(e),1),this.cash+=e.salary}nextCustomer(){return s.updateWaitingNum(this.customerQueue.length-1),this.customerQueue.shift()}addCash(e){this.cash+=e}getCash(){return this.cash}updateCash(e){return e.forEach(e=>{this.addCash(e.price-e.cost)}),e}}class o{constructor(e){if(new.target===o)throw new Error("You cannot instantiate an abstract class!");this.id=Math.random().toString(36).substr(2,16),this.name=e.name,this.salary=e.salary,this.img=e.img}work(){throw new Error("You cannot call an abstract method!")}}class c extends o{constructor(e){if(super(e),this.status="free","object"==typeof c.instance)return c.instance;c.instance=this}work(e){return this.setStatus("busy"),s.renderKitchenDishList(e.dishList),e.dishList.reduce((t,n,r,i)=>t.then(()=>(s.startCountdown(n.time,".kitchen .status",`cooking ${n.name}`),s.wait(1e3*n.time).then(()=>{s.updateLog(`Cook: ${n.name} cooked.`),s.renderKitchenDishList(i.slice(r+1));let t=r===i.length-1;t&&this.setStatus("free"),e.waiter.work(t)}))),Promise.resolve())}setStatus(e){document.querySelector(".kitchen .status").innerHTML=e}}class u extends o{constructor(e){if(super(e),"object"==typeof u.instance)return u.instance;u.instance=this}work(e){if(e&&e.constructor===Array)return s.updateLog("Waiter: We will serve you as soon as possible. (Leaving...)"),s.move(this,"hor",-250),s.wait(1e3).then(()=>({dishList:e,waiter:this}));s.move(this,"hor",150),s.wait(1e3).then(()=>{s.updateLog("Waiter: This is your order. Enjoy!"),e?(s.move(this,"hor",100),s.wait(1e3).then(()=>{s.updateLog("Collecting money..."),this.bye()})):s.move(this,"hor",-250)})}welcome(e){return s.move(e,"hor",-150),s.move(this,"hor",150),s.wait(1e3).then(()=>(s.updateLog(`Waiter: Hello ${e.name}. Welcome to our restaurant. What would you like to eat?`),e))}bye(){let e=document.querySelector(".waiting-area"),t=document.querySelectorAll(".waiting-area img");e.removeChild(t[0]),s.renderDiningDishList([]),s.updateLog("Waiter: I hope you enjoyed your meal. Have a nice day! Bye~ (Cleaning...)")}}class h{constructor(e){this.id=Math.random().toString(36).substr(2,16),this.name=e.name,this.img=e.img}order(e){return s.startCountdown(3,".dining-area .status","ordering"),s.wait(3e3).then(()=>{let t=Math.floor(4*Math.random())+1,n=[];for(;t--;){let t=Math.floor(Math.random()*e.length);n.push(e[t]),e.splice(t,1)}return this.setStatus(""),s.updateLog(this.name+": I want to order "+n.map(e=>e.name)),s.renderDiningDishList(n),n})}eat(){s.updateLog(this.name+": (finished eating..) Very delicious!")}setStatus(e){document.querySelector(".dining-area .status").innerHTML=e}}class l{constructor(e){this.name=e.name,this.cost=e.cost,this.price=e.price,this.time=e.time}}class m{static get RESTAURANT(){return 0}static get COOK(){return 1}static get WAITER(){return 2}static get CUSTOMER(){return 3}static get DISH(){return 4}static getInstance(e,t){switch(e){case this.RESTAURANT:return new a(t);case this.COOK:return new c(t);case this.WAITER:return new u(t);case this.CUSTOMER:return new h(t);case this.DISH:return new l(t);default:throw new Error("Unknown object type.")}}}var d=n(2),g=n.n(d),f=n(1),p=n.n(f),w=n(0),y=n.n(w);const C=m.getInstance(m.RESTAURANT,{cash:1e4,seats:20,staff:[],customerQueue:[]}),S=m.getInstance(m.COOK,{name:"Ramsay",salary:4e3,img:g.a}),I=m.getInstance(m.WAITER,{name:"Cinderella",salary:1e3,img:p.a});C.hire(S),C.hire(I);const L=[m.getInstance(m.DISH,{name:"Sweet and Sour Pork",cost:50,price:100,time:4}),m.getInstance(m.DISH,{name:"Kung Pao Chicken",cost:40,price:80,time:6}),m.getInstance(m.DISH,{name:"Ma Po Tofu",cost:30,price:60,time:6}),m.getInstance(m.DISH,{name:"Dumplings",cost:35,price:70,time:8}),m.getInstance(m.DISH,{name:"Spring Rolls",cost:20,price:50,time:6}),m.getInstance(m.DISH,{name:"Peking Roasted Duck",cost:100,price:200,time:8})];function T(){0!==C.customerQueue.length&&I.welcome(C.nextCustomer()).then(e=>e.order(L.slice())).then(e=>C.updateCash(e)).then(e=>I.work(e)).then(e=>S.work(e)).then(()=>s.wait(3e3)).then(()=>s.updateCash(C)).then(()=>s.wait(1e3)).then(T)}C.customerQueue=[m.getInstance(m.CUSTOMER,{name:"David",img:y.a}),m.getInstance(m.CUSTOMER,{name:"Tom",img:y.a}),m.getInstance(m.CUSTOMER,{name:"Lily",img:y.a}),m.getInstance(m.CUSTOMER,{name:"Robert",img:y.a})],s.initView(C),document.querySelector(".start").addEventListener("click",()=>T())},,function(e,t,n){}]);