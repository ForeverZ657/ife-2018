!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){e.exports=n.p+"5e3120f346f16d449192cc4a369a7810.png"},function(e,t,n){e.exports=n.p+"e880c6a8c20c8bab6781b0cc0fe5b7da.png"},function(e,t,n){e.exports=n.p+"8f07ad3c38516e341a0b85068c703703.png"},function(e,t,n){"use strict";n.r(t);n(5);var i={timeUnit:1e3};function r(e){document.querySelector(".cash").innerHTML=`Cash: ${e.getCash()}`}function s(e){document.querySelector(".waiting-num").innerHTML=`Waiting: ${e}`}var a={wait:function(e){return new Promise(t=>setTimeout(t,e*i.timeUnit))},move:function(e,t,n){let i=document.getElementById(e.id);"hor"===t?i.style.left=n+"px":i.style.top=n+"px"},renderDishList:function(e,t){let n;switch(e){case"kitchen":n=document.querySelector(".kitchen .dish-list");break;case"dining":n=document.querySelector(".dining-area .dish-list")}for(;n.firstChild;)n.removeChild(n.firstChild);t.forEach(e=>{let t=document.createElement("li");t.innerHTML=e.name,n.appendChild(t)})},startCountdown:function(e,t,n){e=e*i.timeUnit/1e3;let r=document.querySelector(t);!function t(){r.innerHTML=`${n} (${e--}s)`,e>0&&setTimeout(t,1e3)}()},initView:function(e){for(let t of e.staff)switch(t.type){case"COOK":let e=new Image;e.src=t.img,document.querySelector(".kitchen").appendChild(e);break;case"WAITER":let n=new Image;n.src=t.img,n.style.transitionDuration=`${i.timeUnit/2/1e3}s`,n.setAttribute("id",t.id),document.querySelector(".dining-area").appendChild(n)}for(let t of e.customerQueue){let e=new Image;e.src=t.img,e.style.transitionDuration=`${i.timeUnit/2/1e3}s`,e.setAttribute("id",t.id),document.querySelector(".waiting-area").appendChild(e)}r(e),s(e.customerQueue.length)},updateCash:r,updateLog:function(e){let t=document.createElement("p");t.innerHTML=e;let n=document.querySelector(".log");n.appendChild(t),n.scrollTop=n.scrollHeight},updateWaitingNum:s};class o{constructor(e){this.cash=e.cash,this.seats=e.seats,this.staff=e.staff,this.customerQueue=e.customerQueue}hire(e){this.staff.push(e),this.cash-=e.salary}fire(e){this.staff.splice(this.staff.indexOf(e),1),this.cash+=e.salary}nextCustomer(){return a.updateWaitingNum(this.customerQueue.length-1),this.customerQueue.shift()}addCash(e){this.cash+=e}getCash(){return this.cash}updateCash(e){return e.forEach(e=>{this.addCash(e.price-e.cost)}),e}}class c{constructor(e){if(new.target===c)throw new Error("You cannot instantiate an abstract class!");this.id=Math.random().toString(36).substr(2,16),this.name=e.name,this.salary=e.salary,this.img=e.img}work(){throw new Error("You cannot call an abstract method!")}}class u extends c{constructor(e){if(super(e),this.status="free",this.type="COOK","object"==typeof u.instance)return u.instance;u.instance=this}work(e){return this.setStatus("busy"),a.renderDishList("kitchen",e.dishList.slice(1)),e.dishList.reduce((t,n,i,r)=>t.then(()=>(a.startCountdown(n.time,".kitchen .status",`cooking ${n.name}`),a.wait(n.time).then(()=>{a.updateLog(`Cook: ${n.name} cooked.`),a.renderDishList("kitchen",r.slice(i+2));let t=i===r.length-1;t&&this.setStatus("free"),e.waiter.work(t)}))),Promise.resolve())}setStatus(e){document.querySelector(".kitchen .status").innerHTML=e}}class h extends c{constructor(e){if(super(e),this.type="WAITER","object"==typeof h.instance)return h.instance;h.instance=this}work(e){if(e&&e.constructor===Array)return a.updateLog("Waiter: We will serve you as soon as possible. (Leaving...)"),a.move(this,"hor",-250),a.wait(.5).then(()=>({dishList:e,waiter:this}));a.move(this,"hor",150),a.wait(.5).then(()=>{a.updateLog("Waiter: This is your order. Enjoy!"),e?(a.move(this,"hor",100),a.wait(.5).then(()=>{a.updateLog("Collecting money..."),this.bye()})):a.move(this,"hor",-250)})}welcome(e){return a.move(e,"hor",-150),a.move(this,"hor",150),a.wait(.5).then(()=>(a.updateLog(`Waiter: Hello ${e.name}. Welcome to our restaurant. What would you like to eat?`),e))}bye(){let e=document.querySelector(".waiting-area"),t=document.querySelectorAll(".waiting-area img");e.removeChild(t[0]),a.renderDishList("dining",[]),a.updateLog("Waiter: I hope you enjoyed your meal. Have a nice day! Bye~ (Cleaning...)")}}class l{constructor(e){this.id=Math.random().toString(36).substr(2,16),this.name=e.name,this.img=e.img}order(e){return a.startCountdown(3,".dining-area .status","ordering"),a.wait(3).then(()=>{let t=Math.floor(4*Math.random())+1,n=[];for(;t--;){let t=Math.floor(Math.random()*e.length);n.push(e[t]),e.splice(t,1)}return this.setStatus(""),a.updateLog(this.name+": I want to order "+n.map(e=>e.name)),a.renderDishList("dining",n),n})}eat(){a.updateLog(this.name+": (finished eating..) Very delicious!")}setStatus(e){document.querySelector(".dining-area .status").innerHTML=e}}class m{constructor(e){this.name=e.name,this.cost=e.cost,this.price=e.price,this.time=e.time}}class d{static get RESTAURANT(){return 0}static get COOK(){return 1}static get WAITER(){return 2}static get CUSTOMER(){return 3}static get DISH(){return 4}static getInstance(e,t){switch(e){case this.RESTAURANT:return new o(t);case this.COOK:return new u(t);case this.WAITER:return new h(t);case this.CUSTOMER:return new l(t);case this.DISH:return new m(t);default:throw new Error("Unknown object type.")}}}var g=n(2),p=n.n(g),f=n(1),y=n.n(f),w=n(0),S=n.n(w);i.timeUnit=1e3;const C=d.getInstance(d.RESTAURANT,{cash:1e4,seats:20,staff:[],customerQueue:[]}),I=d.getInstance(d.COOK,{name:"Ramsay",salary:4e3,img:p.a}),T=d.getInstance(d.WAITER,{name:"Cinderella",salary:1e3,img:y.a});C.hire(I),C.hire(T);const L=[d.getInstance(d.DISH,{name:"Sweet and Sour Pork",cost:50,price:100,time:3}),d.getInstance(d.DISH,{name:"Kung Pao Chicken",cost:40,price:80,time:4}),d.getInstance(d.DISH,{name:"Ma Po Tofu",cost:30,price:60,time:3}),d.getInstance(d.DISH,{name:"Dumplings",cost:35,price:70,time:3}),d.getInstance(d.DISH,{name:"Spring Rolls",cost:20,price:50,time:3}),d.getInstance(d.DISH,{name:"Peking Roasted Duck",cost:100,price:200,time:5})];function b(){0!==C.customerQueue.length?T.welcome(C.nextCustomer()).then(e=>e.order(L.slice())).then(e=>C.updateCash(e)).then(e=>T.work(e)).then(e=>I.work(e)).then(()=>a.wait(2)).then(()=>a.updateCash(C)).then(b):document.querySelector(".reset").style.display="block"}C.customerQueue=[d.getInstance(d.CUSTOMER,{name:"David",img:S.a}),d.getInstance(d.CUSTOMER,{name:"Tom",img:S.a}),d.getInstance(d.CUSTOMER,{name:"Lily",img:S.a}),d.getInstance(d.CUSTOMER,{name:"Robert",img:S.a})],a.initView(C),document.querySelector(".start").addEventListener("click",()=>b()),document.querySelector(".reset").addEventListener("click",()=>location.reload())},,function(e,t,n){}]);